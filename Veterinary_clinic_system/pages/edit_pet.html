<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Pet - PawCare Vet Clinic</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
      <a class="navbar-brand" href="../index.html">
        <i class="fas fa-paw me-2"></i>PawCare Vet Clinic
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="services.html">Services</a></li>
          <li class="nav-item"><a class="nav-link" href="pet_records.html">Pet Records</a></li>
          <li class="nav-item"><a class="nav-link" href="treatments.html">Treatments</a></li>
          <li class="nav-item"><a class="nav-link" href="appointments.html">Appointments</a></li>
          <li class="nav-item"><a class="nav-link" href="vaccinations.html">Vaccinations</a></li>
          <li class="nav-item"><a class="nav-link" href="medication_reminders.html">Medication</a></li>
          <li class="nav-item"><a class="nav-link" href="about.html">About Us</a></li>
          <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
          <li class="nav-item"><a class="nav-link" href="admin_login.html">Admin</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="container mt-4 mb-5">
    <h1 class="fw-bold text-secondary">
      <i class="fas fa-edit me-2 text-primary"></i>Edit Pet Record
    </h1>
    <p class="text-muted">Update your pet's details</p>
  </div>
  <div class="container mb-5">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0 fw-bold">Pet Information</h5>
      </div>
      <div class="card-body">
        <form id="edit-pet-form">
          <input type="hidden" id="pet-id">
          <div class="row g-3">
            <div class="col-md-6">
              <label for="pet-name" class="form-label">Pet Name <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="pet-name" required placeholder="e.g., Max">
            </div>
            <div class="col-md-6">
              <label for="species" class="form-label">Species <span class="text-danger">*</span></label>
              <select class="form-select" id="species" required>
                <option value="">Select Species</option>
                <option value="Dog">Dog</option>
                <option value="Cat">Cat</option>
                <option value="Rabbit">Rabbit</option>
                <option value="Bird">Bird</option>
                <option value="Hamster">Hamster</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="col-md-6">
              <label for="breed" class="form-label">Breed <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="breed" required placeholder="e.g., Golden Retriever">
            </div>
            <div class="col-md-6">
              <label for="dob" class="form-label">Date of Birth <span class="text-danger">*</span></label>
              <input type="date" class="form-control" id="dob" required>
            </div>
            <div class="col-md-6">
              <label for="gender" class="form-label">Gender <span class="text-danger">*</span></label>
              <select class="form-select" id="gender" required>
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Neutered Male">Neutered Male</option>
                <option value="Spayed Female">Spayed Female</option>
              </select>
            </div>
            <div class="col-md-6">
              <label for="weight" class="form-label">Weight (kg)</label>
              <input type="number" class="form-control" id="weight" step="0.1" placeholder="e.g., 12.5">
            </div>
            <div class="col-md-12">
              <h5 class="fw-bold mt-4 mb-3">Owner Information</h5>
            </div>
            <div class="col-md-6">
              <label for="owner-name" class="form-label">Owner Name <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="owner-name" required placeholder="Your full name">
            </div>
            <div class="col-md-6">
              <label for="owner-phone" class="form-label">Phone Number <span class="text-danger">*</span></label>
              <input type="tel" class="form-control" id="owner-phone" required placeholder="e.g., +60123456789">
            </div>
            <div class="col-md-12">
              <label for="owner-email" class="form-label">Email Address <span class="text-danger">*</span></label>
              <input type="email" class="form-control" id="owner-email" required placeholder="e.g., you@example.com">
            </div>
            <div class="col-md-12">
              <label for="medical-notes" class="form-label">Medical Notes</label>
              <textarea class="form-control" id="medical-notes" rows="3" placeholder="Any existing conditions, allergies, or special needs"></textarea>
            </div>
            <div class="col-md-12">
              <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-save me-2"></i>Update Pet Record
              </button>
              <a href="pet_records.html" class="btn btn-outline-secondary btn-lg ms-3">
                <i class="fas fa-arrow-left me-2"></i>Cancel
              </a>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div id="footer-container"></div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
  <script src="../js/main.js"></script>
  <script src="../js/validation.js"></script>
  <script src="../js/pet_records.js"></script>
  <script>
    // Get pet ID from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const petId = parseInt(urlParams.get('id'));

    // Redirect if ID is invalid
    if (!petId) {
      showAlert('Invalid pet ID!', 'danger');
      setTimeout(() => window.location.href = 'pet_records.html', 1500);
    }

    // Get pet data from localStorage
    const allPets = getData('pets');
    let selectedPet = allPets.find(pet => pet.id === petId); // Find pet by ID

    // Redirect if pet not found
    if (!selectedPet) {
      showAlert('Pet record not found!', 'danger');
      setTimeout(() => window.location.href = 'pet_records.html', 1500);
    }

    // Fill form with pet data
    document.getElementById('pet-id').value = selectedPet.id;
    document.getElementById('pet-name').value = selectedPet.petName;
    document.getElementById('species').value = selectedPet.species;
    document.getElementById('breed').value = selectedPet.breed;
    document.getElementById('dob').value = selectedPet.dob;
    document.getElementById('gender').value = selectedPet.gender;
    
    // Set weight (empty if N/A)
    document.getElementById('weight').value = selectedPet.weight === 'N/A' ? '' : selectedPet.weight;
    
    document.getElementById('owner-name').value = selectedPet.ownerName;
    document.getElementById('owner-phone').value = selectedPet.ownerPhone;
    document.getElementById('owner-email').value = selectedPet.ownerEmail;
    
    // Set medical notes (empty if "No notes")
    document.getElementById('medical-notes').value = selectedPet.medicalNotes === 'No notes' ? '' : selectedPet.medicalNotes;

    // Handle edit form submission
    const editForm = document.getElementById('edit-pet-form');
    editForm.addEventListener('submit', function(e) {
      e.preventDefault(); // Prevent page reload

      // Get updated values from form
      const petName = document.getElementById('pet-name').value.trim();
      const species = document.getElementById('species').value;
      const breed = document.getElementById('breed').value.trim();
      const dob = document.getElementById('dob').value;
      const gender = document.getElementById('gender').value;
      let weight = document.getElementById('weight').value.trim();
      const ownerName = document.getElementById('owner-name').value.trim();
      const ownerPhone = document.getElementById('owner-phone').value.trim();
      const ownerEmail = document.getElementById('owner-email').value.trim();
      let medNotes = document.getElementById('medical-notes').value.trim();

      // Set default values
      if (weight === '') weight = 'N/A';
      if (medNotes === '') medNotes = 'No notes';

      // Create updated pet object
      const updatedPet = {
        id: petId,
        petName: petName,
        species: species,
        breed: breed,
        dob: dob,
        gender: gender,
        weight: weight,
        ownerName: ownerName,
        ownerPhone: ownerPhone,
        ownerEmail: ownerEmail,
        medicalNotes: medNotes,
        createdAt: selectedPet.createdAt, 
        updatedAt: new Date().toISOString() 
      };

      // Validate and update pet
      if (!checkPetForm(updatedPet)) return;
      
      // Update pet in localStorage
      const petIndex = allPets.findIndex(pet => pet.id === petId);
      allPets[petIndex] = updatedPet;
      saveData('pets', allPets);

      // Show success and redirect
      showAlert('Pet record updated successfully!', 'success');
      setTimeout(() => window.location.href = 'pet_records.html', 1500);
    });
  </script>
</body>
</html>